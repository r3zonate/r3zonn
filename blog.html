<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>r3zon — Blog</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Athiti:wght@200;300;400;500;600;700&family=Oxanium:wght@200..800&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #0c1018;
  --accent: #00ff99; /* Green for code */
  --accentx: #fff;
  --secondary: #ff00cc; /* Pinkish-red for code */
  --muted: #a0a8c0;
  --glow: rgba(0, 255, 153, 0.7);
  --red-code: #ff4040; /* New red color for code */
}
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
  background: var(--bg);
  font-family: 'Space Mono', monospace;
  /*color: var(--muted);*/
  color: var(--accentx);
  overflow-x: hidden;
}
body {
  background: linear-gradient(135deg, #0c1018, #1c2638);
  position: relative;
}
header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: linear-gradient(to bottom, rgba(17, 17, 17, 0.95), rgba(17, 17, 17, 0.85));
  padding: 15px 0;
  z-index: 50;
  text-align: center;
}
nav a {
  color: var(--accent);
  margin: 0 20px;
  text-decoration: none;
  font-weight: bold;
  font-family: 'Space Mono', monospace;
  font-size: 18px;
  transition: color 0.3s, transform 0.3s;
}
nav a:hover {
  color: #fff;
  text-shadow: 0 0 12px var(--glow);
  transform: translateY(-2px);
}
.search-bar {
  position: fixed;
  top: 70px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 600px;
  z-index: 45;
  background: rgba(15, 20, 30, 0.9);
  border: 2px solid var(--accent);
  border-radius: 8px;
  padding: 10px 20px;
}
.search-input {
  width: 100%;
  background: transparent;
  border: none;
  outline: none;
  color: var(--accent);
  font-family: 'Space Mono', monospace;
  font-size: 16px;
  padding: 5px;
}
.search-input::placeholder {
  color: var(--muted);
}
.circuit-bg {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  opacity: 0.25;
}
.hub-container {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start; 
  padding: 140px 20px 20px;
}
.blog-hub {
  background: rgba(15, 20, 30, 0.9);
  border-radius: 12px;
  width: 90%;
  max-width: 1000px;
  padding: 30px;
  position: relative;
  z-index: 1;
  animation: bootUp 1.5s ease-out;
}
h2 {
  font-family: 'Space Mono', monospace;
  font-size: 38px;
  color: var(--accentx);
  text-align: center;
  margin-bottom: 30px;
  letter-spacing: 4px;
  word-wrap: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
  max-width: 100%;
}
.blog-list {
  column-count: 2;
  column-gap: 24px;
  padding: 10px 0;
}
.blog-card {
  display: inline-block;
  width: 100%;
  margin: 0 0 24px;
  background: rgba(30, 35, 45, 0.85);
  border-radius: 10px;
  padding: 20px;
  box-sizing: border-box;
  box-shadow: 0 6px 14px rgba(0,0,0,0.4);
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  break-inside: avoid;
}
.blog-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 10px 18px rgba(0,0,0,0.55);
}
.blog-card h3 {
  font-size: 20px;
  margin: 0 0 12px;
  color: var(--accentx);
  line-height: 1.4;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
}
.blog-card h3 a {
  text-decoration: none;
  color: var(--accentx);
}
.blog-card h3 a:hover {
  color: var(--accent);
}
.blog-card .meta {
  font-size: 13px;
  color: var(--secondary);
  margin-bottom: 12px;
}
.blog-card p {
  font-size: 16px;
  line-height: 1.6;
  color: var(--muted);
  margin: 0 0 12px;
  word-wrap: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
  max-width: 100%;
}
.tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
.tag {
  background: rgba(0, 255, 153, 0.15);
  padding: 3px 10px;
  border-radius: 5px;
  font-size: 13px;
  color: var(--accent);
  font-family: 'Chakra Petch', sans-serif;
  transition: background 0.3s;
}
.tag:hover {
  background: rgba(0, 255, 153, 0.3);
}
.post-image { 
  width: 100%; max-width: 700px; border-radius: 8px; margin: 15px auto; display: block; animation: slideIn 0.8s ease-out; }
.typed-text { 
  white-space: pre-wrap; overflow: hidden; border-right: 2px solid var(--accent); animation: typing 3s steps(40, end), blink 0.5s step-end infinite; }
.tags { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 20px; }
.tag { background: rgba(0, 255, 153, 0.2); padding: 4px 10px; border-radius: 4px; font-size: 13px; color: var(--accent); font-family: 'Chakra Petch', sans-serif; }
.error-message { color: var(--secondary); font-size: 16px; text-align: center; padding: 20px; }
/* เพิ่ม CSS สำหรับโค้ดสีต่าง ๆ */
p code {
  background: rgba(128,128,128,0.15); /* Gray background */
  color: var(--muted);
  padding: 2px 6px;
  border-radius: 4px;
  font-family: 'Space Mono', monospace;
  font-size: 0.95em;
}
p code.red {
  background: rgba(255, 64, 64, 0.15);
  color: var(--red-code); /* Red text */
}
p code.green {
  background: rgba(0, 255, 153, 0.15);
  color: var(--accent); /* Green text */
}
strong, b {
  font-weight: bold;
  color: var(--accentx); /* White for emphasis, can adjust */
}
pre {
  background: rgba(30, 35, 45, 0.95);
  border: 1px solid rgba(0, 255, 153, 0.2);
  border-radius: 6px;
  padding: 15px;
  margin: 20px 0;
  overflow-x: auto;
}
pre code {
  color: var(--accentx);
  font-family: 'Space Mono', monospace;
  font-size: 0.9em;
  line-height: 1.6;
  white-space: pre;
  display: block;
}
.post-content {
  font-family: 'Athiti', sans-serif;
  font-size: 16px;
}
.post-content p {
  font-family: 'Athiti', sans-serif;
  /*font-size: 16px;*/
}
.post-content strong,
.post-content b {
  font-family: 'Athiti', sans-serif; /* Match Thai font */
}
.post-content span[lang="en"] strong,
.post-content span[lang="en"] b {
  font-family: 'Oxanium', sans-serif; /* Match English font */
}
.post-content span[lang="th"] {
  font-family: 'Athiti', sans-serif !important;
  font-size: 20px;
}
.post-content span[lang="en"] {
  font-family: 'Oxanium', sans-serif;
}
#blog-content .meta {
  color: var(--secondary) !important;
}
@keyframes slideIn { from { transform: translateX(0px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
@keyframes typing { from { width: 0; } to { width: 100%; } }
@keyframes blink { from, to { border-color: transparent; } 50% { border-color: var(--accent); } }
@media (max-width: 768px) {
  .blog-list {
    column-count: 1;
  }
  .blog-card { flex: 1 1 100%; max-width: 100%; }
  .blog-hub { padding: 20px; }
  .post-image { max-width: 100%; }
  .search-bar { top: 60px; width: 80%; max-width: 300px; padding: 8px 15px; }
  .search-input { font-size: 14px; }
  .hub-container { padding: 110px 10px 10px; }
  nav a { margin: 0 10px; font-size: 16px; }
}
html, body { font-family: 'Oxanium', sans-serif; }
span[lang="th"] {
  font-family: 'Athiti', sans-serif !important;
}
span[lang="en"] {
  font-family: 'Oxanium', sans-serif;
}

</style>
</head>
<body>
<header>
  <nav>
    <a href="index.html">Home</a>
    <a href="blog.html">Blog</a>
  </nav>
</header>
<div class="search-bar">
  <input type="text" id="search-input" class="search-input" placeholder="Search blogs...">
</div>
<canvas id="circuit" class="circuit-bg"></canvas>
<div class="hub-container">
  <div class="blog-hub">
    <div id="blog-content" class="blog-list"></div>
  </div>
</div>


<script>
const canvas = document.getElementById('circuit');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
function drawCircuit() {
  ctx.strokeStyle = 'rgba(0, 255, 153, 0.3)';
  ctx.lineWidth = 1;
  ctx.beginPath();
  for (let i = 0; i < canvas.width; i += 50) { ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); }
  for (let i = 0; i < canvas.height; i += 50) { ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); }
  ctx.stroke();
  ctx.fillStyle = 'rgba(0, 255, 153, 0.5)';
  for (let i = 0; i < 20; i++) {
    ctx.beginPath();
    ctx.arc(Math.random()*canvas.width, Math.random()*canvas.height, 3, 0, Math.PI*2);
    ctx.fill();
  }
}
drawCircuit();
window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; drawCircuit(); });

let allPosts = [];
function wrapTextByLang(text) {
  const container = document.createElement("span");
  // Updated regex to capture **bold**, <b>text</b>, and code with optional ! for red
  const parts = text.match(/[\u0E00-\u0E7F]+|[A-Za-z0-9]+|\{img\d+\}|`!([^`]+)`|`([^`]+)`|\*\*([^\*]+)\*\*|<b>([^<]+)<\/b>|[^A-Za-z0-9\u0E00-\u0E7F\{img\d+\}`\*\*<]+/g) || [];
  // ใน wrapTextByLang ให้เพิ่ม regex สำหรับ r! และ g!
  parts.forEach(part => {
    if (/^[\u0E00-\u0E7F]+$/.test(part)) { 
      const span = document.createElement("span");
      span.setAttribute("lang", "th"); 
      span.textContent = part; 
      container.appendChild(span);
    } else if (/^[A-Za-z0-9]+$/.test(part)) { 
      const span = document.createElement("span"); 
      span.setAttribute("lang", "en"); 
      span.textContent = part; 
      container.appendChild(span);
    } else if (part.match(/^`r!([^`]+)`$/)) { // Red code
      const code = document.createElement("code");
      code.className = "red";
      code.textContent = part.match(/^`r!([^`]+)`$/)[1];
      container.appendChild(code);
    } else if (part.match(/^`g!([^`]+)`$/)) { // Green code
      const code = document.createElement("code");
      code.className = "green";
      code.textContent = part.match(/^`g!([^`]+)`$/)[1];
      container.appendChild(code);
    } else if (part.match(/^`([^`]+)`$/)) { // Default gray code
      const code = document.createElement("code");
      code.textContent = part.match(/^`([^`]+)`$/)[1];
      container.appendChild(code);
    } else if (part.match(/^\*\*([^\*]+)\*\*$/)) { // Markdown bold
      const strong = document.createElement("strong");
      strong.textContent = part.match(/^\*\*([^\*]+)\*\*$/)[1];
      container.appendChild(strong);
    } else if (part.match(/^<b>([^<]+)<\/b>$/)) { // HTML bold
      const b = document.createElement("b");
      b.textContent = part.match(/^<b>([^<]+)<\/b>$/)[1];
      container.appendChild(b);
    } else { 
      container.appendChild(document.createTextNode(part)); 
    }
  });

  return container.innerHTML;
}

async function loadContent() {
  try {
    const urlParams = new URLSearchParams(window.location.search);
    const postId = urlParams.get('id');
    const res = await fetch("static/posts.json");
    if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);
    allPosts = await res.json();
    const contentDiv = document.getElementById("blog-content");
    if (postId) {
      const post = allPosts.find(p => p.id == postId);
      if (post) {
        contentDiv.className = "";
        const wrappedTitle = wrapTextByLang(post.title);
        contentDiv.innerHTML = `
          <h2>${wrappedTitle}</h2>
          <div class="meta">${post.date} • ${post.readTime}</div>
          <div class="post-content"></div>
          <div class="tags">${post.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}</div>
        `;
        const postContent = document.querySelector(".post-content");
        if (post.file) {
          console.log(`Fetching post file: static/${post.file}`);
          fetch(`static/${post.file}`)
            .then(res => {
              if (!res.ok) throw new Error(`File not found: ${post.file}`);
              return res.text();
            })
            .then(text => {
              console.log("Post content:", text);
              const segments = text.split('\n');
              let inCodeBlock = false;
              let codeBuffer = [];
              segments.forEach(segment => {
                console.log("Processing segment:", segment);
                if (segment.startsWith("```")) {
                  if (inCodeBlock) {
                    const pre = document.createElement("pre");
                    const code = document.createElement("code");
                    code.textContent = codeBuffer.join("\n");
                    pre.appendChild(code);
                    postContent.appendChild(pre);
                    codeBuffer = [];
                    inCodeBlock = false;
                  } else {
                    inCodeBlock = true;
                  }
                } else if (inCodeBlock) {
                  codeBuffer.push(segment);
                } else {
                  let wrapped = wrapTextByLang(segment);
                  let html = wrapped
                    .replace(/\{img(\d+)\}/g, (match, index) => {
                      const imgObj = post.images ? post.images.find(img => img.position == index) : null;
                      console.log(`Replacing {img${index}}:`, imgObj ? imgObj.src : 'No image found');
                      return imgObj ? `<img class="post-image" src="${imgObj.src}" alt="Image ${index}" onerror="this.outerHTML='<p class=\\'error-message\\'>Failed to load image: ${imgObj.src}</p>';">` : '';
                    });
                  const p = document.createElement("p");
                  p.innerHTML = html;
                  postContent.appendChild(p);
                }
              });
              if (inCodeBlock && codeBuffer.length > 0) {
                const pre = document.createElement("pre");
                const code = document.createElement("code");
                code.textContent = codeBuffer.join("\n");
                pre.appendChild(code);
                postContent.appendChild(pre);
              }
            })
            .catch(err => {
              postContent.innerHTML = `<p class="error-message">Not found! ${post.file}</p>`;
              console.error(err);
            });
        }
      }
    } else {
      contentDiv.className = "blog-list";
      renderPosts(allPosts);
    }
  } catch (err) {
    console.error("Error loading posts.json:", err.message);
    const contentDiv = document.getElementById("blog-content");
    contentDiv.className = ""; 
    contentDiv.innerHTML = '<p class="error-message">Failed to load blog posts. Please try again later.</p>';
  }
}
function renderPosts(posts) {
  const contentDiv = document.getElementById("blog-content"); 
  contentDiv.innerHTML = '';
  if (!posts.length) { 
    contentDiv.className = ""; 
    contentDiv.innerHTML = '<p class="error-message">No posts found matching your search.</p>'; 
    return; 
  }
  contentDiv.className = "blog-list";
  posts.forEach(post => {
    const card = document.createElement("div");
    card.className = `blog-card ${post.featured ? "featured" : ""}`;
    const coverImage = post.images ? post.images.find(img => img.position === 1) : null;
    const wrappedTitle = wrapTextByLang(post.title);
    const wrappedExcerpt = wrapTextByLang(post.excerpt);
    card.innerHTML = `<h3><a href="blog.html?id=${post.id}">${wrappedTitle}</a></h3><div class="meta">${post.date} • ${post.readTime}</div>${coverImage ? `<img class="post-image" src="${coverImage.src}" alt="Cover image for ${post.title}" onerror="this.outerHTML='<p class=\\'error-message\\'>Failed to load image: ${coverImage.src}</p>'">` : ''} <p>${wrappedExcerpt}</p><div class="tags">${post.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}</div>`;
    contentDiv.appendChild(card);
  });
}

const searchInput = document.getElementById('search-input');
searchInput.addEventListener('input', () => {
  const query = searchInput.value.toLowerCase();
  const filteredPosts = allPosts.filter(post =>
    post.title.toLowerCase().includes(query) ||
    post.excerpt.toLowerCase().includes(query) ||
    post.tags.some(tag => tag.toLowerCase().includes(query))
  );
  renderPosts(filteredPosts);
});
loadContent();
</script>
</body>
</html>
